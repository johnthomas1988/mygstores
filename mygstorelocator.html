<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>myG Store Locator</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        .filters, .branch-container {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 20px;
            background-color: #f9f9f9;
        }
        .branch {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #fff;
            display: flex;
            flex-direction: column;
        }
        .branch h3 {
            margin: 0;
            color: #333;
        }
        .branch p {
            margin: 5px 0;
            color: #555;
        }
        .branch span {
            font-weight: bold;
        }
        input[type="text"], select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .filter-col {
            flex: 1;
            margin-right: 10px;
        }
        .filter-col:last-child {
            margin-right: 0;
        }
        .search-container {
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
        }
        .reset-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #f44336; /* Red */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            padding: 10px 15px;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

<h1>myG Store Locator</h1>
<button class="reset-button" onclick="resetFilters()">Reset Filters</button>

<div class="search-container">
    <div style="flex: 1; margin-right: 10px;">
        <input type="text" id="pincodeInput" placeholder="Enter Pincode" />
    </div>
    <div style="flex: 1; margin-right: 10px;">
        <label for="distance">Choose Distance:</label>
        <select id="distance">
            <option value="20">20 km</option>
            <option value="30">30 km</option>
            <option value="40">40 km</option>
            <option value="50">50 km</option>
        </select>
    </div>
    <button onclick="findNearestStore()">Find Nearest Store</button>
</div>

<div class="filters">
    <div class="filter-row">
        <div class="filter-col">
            <label for="district">District:</label>
            <select id="district" onchange="filterBranches()">
                <option value="">Select District</option>
            </select>
        </div>
        <div class="filter-col">
            <label for="storeCategory">Store Category:</label>
            <select id="storeCategory" onchange="filterBranches()">
                <option value="">Select Store Category</option>
                <option value="myG Store">myG Store</option>
                <option value="Future Store">Future Store</option>
            </select>
        </div>
    </div>
    <div class="filter-row">
        <div class="filter-col">
            <label for="rbm">RBM:</label>
            <select id="rbm" onchange="filterBranches()">
                <option value="">Select RBM</option>
            </select>
        </div>
        <div class="filter-col">
            <label for="bdm">BDM:</label>
            <select id="bdm" onchange="filterBranches()">
                <option value="">Select BDM</option>
            </select>
        </div>
    </div>
</div>

<input type="text" id="searchInput" placeholder="Advanced Search..." onkeyup="searchBranches()" />

<div class="branch-container" id="branchContainer"></div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    let branchData = [];

    // Load the branch data from GitHub
    $.getJSON('https://raw.githubusercontent.com/johnthomas1988/mygstores/refs/heads/main/BranchMaster10-10-24.json', function(data) {
        branchData = data;
        populateDistricts(data);
        populateRBM(data);
        populateBDM(data);
        populateBranches(data);
    });

    // Populate districts in the dropdown
    function populateDistricts(data) {
        const districts = [...new Set(data.map(item => item.District))];
        districts.forEach(district => {
            $('#district').append(new Option(district, district));
        });
    }

    // Populate RBMs in the dropdown
    function populateRBM(data) {
        const rbms = [...new Set(data.map(item => item.RBM))];
        rbms.forEach(rbm => {
            $('#rbm').append(new Option(rbm, rbm));
        });
    }

    // Populate BDMs in the dropdown
    function populateBDM(data) {
        const bdms = [...new Set(data.map(item => item.BDM))];
        bdms.forEach(bdm => {
            $('#bdm').append(new Option(bdm, bdm));
        });
    }

    // Filter branches based on selected criteria
    function filterBranches() {
        const selectedDistrict = $('#district').val();
        const selectedStoreCategory = $('#storeCategory').val();
        const selectedRBM = $('#rbm').val();
        const selectedBDM = $('#bdm').val();

        const filteredBranches = branchData.filter(branch => {
            return (
                (!selectedDistrict || branch.District === selectedDistrict) &&
                (!selectedStoreCategory || branch.StoreCategory === selectedStoreCategory) &&
                (!selectedRBM || branch.RBM === selectedRBM) &&
                (!selectedBDM || branch.BDM === selectedBDM)
            );
        });

        displayBranches(filteredBranches);
    }

    // Display branches in the container
    function displayBranches(branches) {
        $('#branchContainer').empty();
        branches.forEach(branch => {
            $('#branchContainer').append(`
                <div class="branch">
                    <h3>${branch.BranchName} (${branch.BranchCode})</h3>
                    <p><span>RBM:</span> ${branch.RBM}</p>
                    <p><span>BDM:</span> ${branch.BDM}</p>
                    <p><span>Address:</span> ${capitalizeAddress(branch.Address)}, Pincode: ${branch.Pincode}</p>
                    <p><span>Store Number:</span> ${branch.StoreNumber}</p>
                    <p><span>Email:</span> ${branch.Email}</p>
                </div>
            `);
        });
    }

    // Capitalize each word in the address
    function capitalizeAddress(address) {
        return address.replace(/\b\w/g, char => char.toUpperCase());
    }

    // Search branches based on user input across all fields
    function searchBranches() {
        const searchValue = $('#searchInput').val().toLowerCase();
        const filteredBranches = branchData.filter(branch => 
            branch.BranchName.toLowerCase().includes(searchValue) ||
            branch.Address.toLowerCase().includes(searchValue) ||
            branch.RBM.toLowerCase().includes(searchValue) ||
            branch.BDM.toLowerCase().includes(searchValue) ||
            branch.StoreNumber.toString().includes(searchValue) ||
            branch.Email.toLowerCase().includes(searchValue)
        );
        displayBranches(filteredBranches);
    }

    // Find nearest store based on pincode and distance
    function findNearestStore() {
        const pincode = $('#pincodeInput').val();
        const maxDistance = parseInt($('#distance').val());

        // For simplicity, we'll just display branches within the same pincode for now
        const nearestBranches = branchData.filter(branch => {
            return branch.Pincode.startsWith(pincode) && calculateDistance(branch.Pincode, pincode) <= maxDistance;
        });

        displayBranches(nearestBranches);
    }

    // Dummy function to calculate distance based on pincodes (needs real implementation)
    function calculateDistance(storePincode, userPincode) {
        // Replace this with actual distance calculation
        return Math.abs(parseInt(storePincode) - parseInt(userPincode)) <= 20 ? 20 : 0; 
    }

    // Reset all filters
    function resetFilters() {
        $('#district').val('');
        $('#storeCategory').val('');
        $('#rbm').val('');
        $('#bdm').val('');
        $('#searchInput').val('');
        $('#pincodeInput').val('');
        $('#distance').val('20'); // Reset distance to default
        displayBranches(branchData); // Show all branches again
    }
</script>
</body>
</html>
