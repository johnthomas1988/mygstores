<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Branch Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        .branch-container {
            margin-top: 20px;
        }
        .branch {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #fff;
        }
        .branch h3 {
            margin: 0;
            color: #333;
        }
        .branch p {
            margin: 5px 0;
            color: #555;
        }
        .branch span {
            font-weight: bold;
        }
        .filters, .search-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            width: 150px;
        }
        .filter-group label {
            margin-bottom: 5px;
            color: #444;
        }
        .search-container {
            margin-bottom: 10px;
        }
        .reset-button {
            background-color: #ff4c4c;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .reset-button:hover {
            background-color: #ff1a1a;
        }
        #search {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<div class="search-container">
    <label for="pincode">Enter Pincode:</label>
    <input type="text" id="pincode" placeholder="Pincode">
    <label for="distance">Select Distance (in km):</label>
    <select id="distance">
        <option value="20">20 km</option>
        <option value="30">30 km</option>
        <option value="40">40 km</option>
        <option value="50">50 km</option>
    </select>
    <button onclick="findNearestStore()">Find Nearest Store</button>
</div>

<div class="filters">
    <div class="filter-group">
        <label for="district">District</label>
        <select id="district" onchange="filterBranches()"></select>
    </div>
    <div class="filter-group">
        <label for="storeCategory">Store Category</label>
        <select id="storeCategory" onchange="filterBranches()"></select>
    </div>
    <div class="filter-group">
        <label for="rbm">RBM</label>
        <select id="rbm" onchange="filterBranches()"></select>
    </div>
    <div class="filter-group">
        <label for="bdm">BDM</label>
        <select id="bdm" onchange="filterBranches()"></select>
    </div>
</div>

<input type="text" id="search" placeholder="Search by Branch Name..." oninput="searchBranches()">

<button class="reset-button" onclick="resetFilters()">Reset Filters</button>

<div class="branch-container" id="branchContainer"></div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    let branchData = [];

    // Load the branch data from GitHub
    $.getJSON("https://raw.githubusercontent.com/johnthomas1988/mygstores/refs/heads/main/BranchMaster10-10-24.json", function(data) {
        branchData = data;
        populateFilters(data);
        displayBranches(data);
    });

    // Populate filters with unique values
    function populateFilters(data) {
        const districts = [...new Set(data.map(item => item.District))];
        districts.forEach(district => {
            $('#district').append(new Option(district, district));
        });

        const storeCategories = [...new Set(data.map(item => item.StoreCategory))];
        storeCategories.forEach(category => {
            $('#storeCategory').append(new Option(category, category));
        });

        const rbms = [...new Set(data.map(item => item.RBM))];
        rbms.forEach(rbm => {
            $('#rbm').append(new Option(rbm, rbm));
        });

        const bdms = [...new Set(data.map(item => item.BDM))];
        bdms.forEach(bdm => {
            $('#bdm').append(new Option(bdm, bdm));
        });
    }

    // Filter branches based on selected criteria
    function filterBranches() {
        const selectedDistrict = $('#district').val();
        const selectedCategory = $('#storeCategory').val();
        const selectedRbm = $('#rbm').val();
        const selectedBdm = $('#bdm').val();

        const filteredBranches = branchData.filter(branch => {
            return (
                (selectedDistrict === "" || branch.District === selectedDistrict) &&
                (selectedCategory === "" || branch.StoreCategory === selectedCategory) &&
                (selectedRbm === "" || branch.RBM === selectedRbm) &&
                (selectedBdm === "" || branch.BDM === selectedBdm)
            );
        });

        displayBranches(filteredBranches);
    }

    // Display branches in a structured format
    function displayBranches(branches) {
        $('#branchContainer').empty();
        branches.forEach(branch => {
            const branchDiv = `
                <div class="branch">
                    <h3>${branch.BranchName} (${branch.BranchCode})</h3>
                    <p><span>RBM:</span> ${branch.RBM}</p>
                    <p><span>BDM:</span> ${branch.BDM}</p>
                    <p><span>Address:</span> ${capitalizeAddress(branch.Address)}</p>
                    <p><span>Pincode:</span> ${branch.Pincode}</p>
                </div>
            `;
            $('#branchContainer').append(branchDiv);
        });
    }

    // Capitalize address for better readability
    function capitalizeAddress(address) {
        return address.replace(/\w\S*/g, (txt) => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase());
    }

    // Search branches based on input
    function searchBranches() {
        const query = $('#search').val().toLowerCase();
        const filteredBranches = branchData.filter(branch => 
            branch.BranchName.toLowerCase().includes(query)
        );
        displayBranches(filteredBranches);
    }

    // Find nearest stores based on pincode and distance
    function findNearestStore() {
        const pincodeInput = $('#pincode').val();
        const distanceInput = $('#distance').val();

        if (!pincodeInput || !distanceInput) {
            alert("Please enter both pincode and distance.");
            return;
        }

        const userPincode = parseInt(pincodeInput);
        const maxDistance = parseInt(distanceInput);

        // Simplified distance check based on pincode
        const nearestBranches = branchData.filter(branch => {
            const branchPincode = parseInt(branch.Pincode);
            return Math.abs(branchPincode - userPincode) <= maxDistance;
        });

        displayBranches(nearestBranches);
    }

    // Reset all filters and search
    function resetFilters() {
        $('#district').val('');
        $('#storeCategory').val('');
        $('#rbm').val('');
        $('#bdm').val('');
        $('#search').val('');
        $('#pincode').val('');
        $('#distance').val('20');
        displayBranches(branchData);
    }
</script>

</body>
</html>
